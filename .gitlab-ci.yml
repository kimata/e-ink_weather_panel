image: docker:23.0

stages:
  - test
  - build

variables:
  NAME: e-ink_weather_panel
  
# サンプル設定ファイルで，問題なく動くかチェック
check-sample:
  stage: test
    
  script:
    - docker build . -t ${NAME}
    - docker run -t ${NAME} src/create_image.py -f config.example.yaml > /dev/null

# 本番設定ファイルで，問題なく動くかチェック
check-regular:
  stage: test
  image: ubuntu:22.04

  script:
    - apt update
    - apt install -y docker.io git
    - git clone http://gitlab.green-rabbit.net/kimata/panel_config.git
    - mv panel_config/e-ink_weather.yaml config.yaml
    - rm -rf font
    - git clone http://gitlab.green-rabbit.net/kimata/font.git
    - docker build . -t ${NAME}
    - docker run -t ${NAME} src/create_image.py -f config.yaml > /dev/null

